name: API Auto Update  # The name of the workflow indicates its purpose to automatically update the API documentation.

on:  # Defines the events that trigger the workflow.
  push:
    branches: ["main"]
  workflow_dispatch:  # This allows the workflow to be manually triggered.

permissions:
  contents: write
  pages: write
  id-token: write

concurrency:
  group: "pages"

jobs:
  deploy:  # Defines a job called 'deploy'.
    runs-on: ubuntu-latest  # Specifies the virtual environment where the job will run.

    steps:  
      - name: Checkout  # Step to checkout the repository's code.
        uses: actions/checkout  # Uses the actions/checkout action to access the repository code.

      - name: Setup Pages  # Step to configure GitHub Pages.
        uses: actions/configure-pages

      - name: Install dependencies and Generate Documentation  # Step to install dependencies and generate documentation.
        run: |
          chmod +x ./api.sh
          ./api.sh

      - name: Upload artifact  # Step to upload the built site as an artifact.
        uses: actions/upload-pages-artifact
        with:
          path: docs/api

      - name: Deploy to GitHub Pages  # Step to deploy to GitHub Pages.
        id: deployment
        uses: peaceiris/actions-gh-pages
        with:
          publish_branch: gh-pages  # Specifies the branch to deploy to.
          github_token: ${{ secrets.GITHUB_TOKEN }}  # Authenticates using a GitHub Token.
          publish_dir: ./docs/api  # Specifies the directory to deploy.